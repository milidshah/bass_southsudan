---
title: "Survey Dashboard"
subtitle: "2024 IOM South Sudan"
author: "Data & Methods Subteam - Bass Connections"
date: "2024-09-29"
output:
 html_document:
   theme: journal
   toc: true
   toc_float: true
---

```{r}
#install packages

install.packages("sjmisc")
install.packages("likert")


```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
library(ggthemes)
library(readxl)
library(purrr)
library(janitor)
library(forcats)
library(scales)
library(knitr)
library(kableExtra)

library(sjmisc)
library(likert)
library(writexl)

options(digits=2)
```

```{r data, include=FALSE}

# Setting up directory

sudan_v2_df <- read.csv("data/Bass_Team_Data_V2.csv")

```

Total number of respondents: **`r df %>% nrow()`**

All question numbers below are based on the "Key Variables for Descriptive Statistics" doc file.

All the descriptives calculated for index questions were based on the **unimputed** variable.

```{r}
#see all variables
#names(sudan_v2_df)

# Use grep to find column names
matching_columns <- grep("^Q10.1.10", names(sudan_v2_df), value = TRUE)

# Print the matching columns
matching_columns


```

# 1) Political and Legal Fragility

All the answers are in a \*scale of 0-1\*\*, i.e. can have the following values: 0, 0.25, 0.5, 0.75, 1. The higher, the more fragile.

The higher, the more fragile.

## Index Questions

### Q10.1.2: How much confidence do you have in your state government? {.tabset}

0 (none) to 1 (a lot)

#### Entire sample

```{r Q10.1.2_raw, eval = TRUE, warnings = FALSE, echo = FALSE, message = FALSE, out.width="65%"}

sudan_v2_df |>
  summarize(mean = mean(Q10.1.2_unimputed, na.rm = TRUE)) |>
  kable(align = "lc") |>
  kable_styling(position = "left", full_width = F)

sudan_v2_df |>
  group_by(Q10.1.2_raw) |>
  summarise(answers = n()) |>
  arrange(desc(answers)) |>
  select(Q10.1.2_raw, answers) |>
  mutate(percentage = answers/sum(answers)) |>
  kable(align = "lc", 
        col.names = c("Response", "Number of Responses", "Percent of Total Responses")) |>
  kable_styling(position = "left", full_width = F)

sudan_v2_df |>
  group_by(Q10.1.2_raw) |>
  summarise(answers = n()) |>
  arrange(desc(-answers)) |>
  select(Q10.1.2_raw, answers) |>
  mutate(percentage = answers / sum(answers), Q10.1.2_raw = factor(Q10.1.2_raw)) |>
  ggplot(aes(Q10.1.2_raw, answers)) +
  geom_col(fill = "#263e58") +
   geom_text(aes(label = answers), 
            vjust = 0.5,
            hjust = -0.3,
            size = 2.0) +
  labs(x = "Q10.1.2: Trust in State Governments", y = "Number of respondents") +
  theme(axis.text.x = element_text(size = 11),
        axis.title.x = element_text(margin = margin(t = 10))) +
  theme_minimal() +
  coord_flip()

```

#### By county

```{r Q10.1.2_raw by county, eval = TRUE, warnings = FALSE, echo = FALSE, message = FALSE, out.width="65%"}

sudan_v2_df |> 
  group_by(Q1.5_County) |> 
  summarize(mean = mean(Q10.1.2_unimputed, na.rm = TRUE)) |> 
  kable(align = "lc", col.names = c("County", "Mean Response (0 to 1)")) |>
  kable_styling(position = "left", full_width = F)

sudan_v2_df|>
  group_by(Q10.1.2_raw, Q1.5_County) |>
  summarize(answers = n()) |>
  arrange(desc(Q1.5_County)) |>
  select(Q1.5_County, Q10.1.2_raw, answers) |>
  mutate(percentage = answers/sum(answers)) |>
  kable(align = "lc", col.names = c("County", "Response", "Number of Responses", "Percent of Total Responses")) |>
  kable_styling(position = "left", full_width = F)

```

### Q10.1.10: How much confidence do you have in informal authorities, such as councils of elders? {.tabset}

0 (none) to 1 (a lot)

#### Entire sample

```{r Q10.1.10_raw, eval = TRUE, warnings = FALSE, echo = FALSE, message = FALSE, out.width="65%"}

sudan_v2_df |>
  summarize(mean = mean(Q10.1.10_unimputed, na.rm = TRUE)) |>
  kable(align = "lc") |>
  kable_styling(position = "left", full_width = F)

sudan_v2_df |>
  group_by(Q10.1.10_raw) |>
  summarise(answers = n()) |>
  arrange(desc(answers)) |>
  select(Q10.1.10_raw, answers) |>
  mutate(percentage = answers/sum(answers)) |>
  kable(align = "lc", 
        col.names = c("Response", "Number of Responses", "Percent of Total Responses")) |>
  kable_styling(position = "left", full_width = F)

sudan_v2_df |>
  group_by(Q10.1.10_raw) |>
  summarise(answers = n()) |>
  arrange(desc(-answers)) |>
  select(Q10.1.10_raw, answers) |>
  mutate(percentage = answers / sum(answers), Q10.1.2_raw = factor(Q10.1.10_raw)) |>
  ggplot(aes(Q10.1.10_raw, answers)) +
  geom_col(fill = "#263e58") +
  geom_text(aes(label = answers), 
            vjust = 0.5,
            hjust = -0.3,
            size = 2.0) +
  labs(x = "Q10.1.10: Trust in Informal Authorities", y = "Number of respondents") +
  theme(axis.text.x = element_text(size = 11),
        axis.title.x = element_text(margin = margin(t = 10))) +
  theme_minimal() +
  coord_flip()


```

#### By county

```{r Q10.1.10_raw by county, eval = TRUE, warnings = FALSE, echo = FALSE, message = FALSE, out.width="65%"}

sudan_v2_df |> 
  group_by(Q1.5_County) |> 
  summarize(mean = mean(Q10.1.10_unimputed, na.rm = TRUE)) |> 
  kable(align = "lc", col.names = c("County", "Mean Response (0 to 1)")) |>
  kable_styling(position = "left", full_width = F)

sudan_v2_df|>
  group_by(Q10.1.10_raw, Q1.5_County) |>
  summarize(answers = n()) |>
  arrange(desc(Q1.5_County)) |>
  select(Q1.5_County, Q10.1.10_raw, answers) |>
  mutate(percentage = answers/sum(answers)) |>
  kable(align = "lc", col.names = c("County", "Response", "Number of Responses", "Percent of Total Responses")) |>
  kable_styling(position = "left", full_width = F)

```

### Q10.10: South Sudanâ€™s next national elections are scheduled for December 2024 after being postponed several times. How safe or unsafe would you feel going to a polling station to cast your vote? {.tabset}

0 (very unsafe) to 1 (very safe)

#### Entire sample

```{r Q5.5.3, eval = TRUE, echo = FALSE, warnings = FALSE, message = FALSE, out.width="65%"}

df %>% 
  summarize(mean = mean(Q5.5.3_unimputed, na.rm = TRUE)) %>%
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

df %>%
  group_by(Q5.5.3_raw) %>%
  summarise(answers = n()) %>%
  arrange(desc(answers)) %>%
  select(Q5.5.3_raw, answers) %>%
  mutate(percentage = answers/sum(answers)) %>%
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

df %>%
  group_by(Q5.5.3_raw) %>%
  summarise(answers = n()) %>%
  arrange(desc(-answers)) %>%
  select(Q5.5.3_raw, answers) %>%
  mutate(percentage = answers / sum(answers),
         Q5.5.3_raw = factor(Q5.5.3_raw)) %>%
  ggplot(aes(Q5.5.3_raw, answers)) +
  geom_col(fill = "#263e58") +
  labs(x = "Q5.5.3", y = "Number of respondents") +
  theme(axis.text.x = element_text(size = 11),
        axis.title.x = element_text(margin = margin(t = 10))) +
  coord_flip()

```

#### By county

```{r Q5.5.3 by county, eval = TRUE, echo = FALSE, warnings = FALSE, message = FALSE, out.width="65%"}

df %>% 
  group_by(Q1.5_County) %>% 
  summarize(mean = mean(Q5.5.3_unimputed, na.rm = TRUE)) %>% 
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

df %>%
  group_by(Q5.5.3_raw, Q1.5_County) %>%
  summarise(answers = n()) %>%
  arrange(desc(Q1.5_County)) %>%
  select(Q1.5_County, Q5.5.3_raw, answers) %>%
  mutate(percentage = answers/sum(answers)) %>%
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

```

### Q10.12: At present, how safe do you feel speaking publicly on politically sensitive issues? {.tabset}

0(very unsafe) to 1(very safe)

#### Entire sample

```{r Q7.1, eval = TRUE, echo = FALSE, warnings = FALSE, message = FALSE, out.width="65%"}

df %>% 
  summarize(mean = mean(Q7.1_unimputed, na.rm = TRUE)) %>%
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

df %>%
  group_by(Q7.1_raw) %>%
  summarise(answers = n()) %>%
  arrange(desc(answers)) %>%
  select(Q7.1_raw, answers) %>%
  mutate(percentage = answers/sum(answers)) %>%
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

df %>%
  group_by(Q7.1_raw) %>%
  summarise(answers = n()) %>%
  arrange(desc(-answers)) %>%
  select(Q7.1_raw, answers) %>%
  mutate(percentage = answers / sum(answers),
         Q7.1_raw = factor(Q7.1_raw)) %>%
  ggplot(aes(Q7.1_raw, answers)) +
  geom_col(fill = "#263e58") +
  labs(x = "Q7.1", y = "Number of respondents") +
  theme(axis.text.x = element_text(size = 11),
        axis.title.x = element_text(margin = margin(t = 10))) +
  coord_flip()

```

#### By county

```{r Q7.1 by county, eval = TRUE, echo = FALSE, warnings = FALSE, message = FALSE, out.width="65%"}

df %>% 
  group_by(Q1.5_County) %>% 
  summarize(mean = mean(Q7.1_unimputed, na.rm = TRUE)) %>% 
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

df %>%
  group_by(Q7.1_raw, Q1.5_County) %>%
  summarise(answers = n()) %>%
  arrange(desc(Q1.5_County)) %>%
  select(Q1.5_County, Q7.1_raw, answers) %>%
  mutate(percentage = answers/sum(answers)) %>%
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

```

### Q10.13: Which of the following statements best describes the role that politicians in Juba play in your community? {.tabset}

0(they make the community much less safe) to 1(they make the community much more safe)

#### Entire sample

```{r Q8.5.6, eval = TRUE, echo = FALSE, warnings = FALSE, message = FALSE, out.width="65%"}

df %>% 
  summarize(mean = mean(Q8.5.6_unimputed, na.rm = TRUE)) %>%
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

df %>%
  group_by(Q8.5.6_raw) %>%
  summarise(answers = n()) %>%
  arrange(desc(answers)) %>%
  select(Q8.5.6_raw, answers) %>%
  mutate(percentage = answers/sum(answers)) %>%
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

df %>%
  group_by(Q8.5.6_raw) %>%
  summarise(answers = n()) %>%
  arrange(desc(-answers)) %>%
  select(Q8.5.6_raw, answers) %>%
  mutate(percentage = answers / sum(answers),
         Q8.5.6_raw = factor(Q8.5.6_raw)) %>%
  ggplot(aes(Q8.5.6_raw, answers)) +
  geom_col(fill = "#263e58") +
  labs(x = "Q8.5.6", y = "Number of respondents") +
  theme(axis.text.x = element_text(size = 11),
        axis.title.x = element_text(margin = margin(t = 10))) +
  coord_flip()

```

#### By county

```{r Q8.5 by county, eval = TRUE, echo = FALSE, warnings = FALSE, message = FALSE, out.width="65%"}

df %>% 
  group_by(Q1.5_County) %>% 
  summarize(mean = mean(Q8.5.6_unimputed, na.rm = TRUE)) %>% 
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

df %>%
  group_by(Q8.5.6_raw, Q1.5_County) %>%
  summarise(answers = n()) %>%
  arrange(desc(Q1.5_County)) %>%
  select(Q1.5_County, Q8.5.6_raw, answers) %>%
  mutate(percentage = answers/sum(answers)) %>%
  kable(align = "lc") %>%
  kable_styling(position = "left", full_width = F)

```

## 

# Additional Political/Legal Descriptive Questions

### Q9.1 {.tabset}

### Q9.2 {.tabset}

### Q9.3 {.tabset}

### Q9.4 {.tabset}

### Q9.5 {.tabset}

### Q10.1 ALL {.tabset}
